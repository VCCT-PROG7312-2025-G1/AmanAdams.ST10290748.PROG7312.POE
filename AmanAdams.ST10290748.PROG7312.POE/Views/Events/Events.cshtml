@model AmanAdams.ST10290748.PROG7312.POE.Models.EventViewModel

@{
    ViewData["Title"] = "Local Events And Announcements";
}

<h2 style="text-align:center; color:cadetblue;">Local Events and Announcements</h2>

<!-- Success Tooltip (Chatgpt) -->
@if (TempData["SuccessMessage"] != null)
{
    <div id="success-tooltip" class="tooltip">@TempData["SuccessMessage"]</div>
    <script>
        setTimeout(() => document.getElementById('success-tooltip').style.display = 'none', 3000);
    </script>
}

@{
    var loggedInUser = Context.Session.GetString("LoggedInUser");
}

@if (!string.IsNullOrEmpty(loggedInUser))
{
<!-- Add Event / Announcement Form -->
<div class="event-form">
    <h3>Add New Event / Announcement</h3>
    <form asp-action="AddEvent" asp-controller="Events" method="post" enctype="multipart/form-data">
        <label>Title:</label>
        <input type="text" name="Title" required />

        <label>Description:</label>
        <textarea name="Description" required></textarea>

        <label>Category:</label>
        <input type="text" name="Category" required />

        <label>Date:</label>
        <input type="date" name="EventDate" required />

        <label>Type:</label>
        <select name="Type" required>
            <option value="Event">Event</option>
            <option value="Announcement">Announcement</option>
        </select>

        <label>Photo:</label>
        <input type="file" name="Photo" accept="image/*" />

        <button type="submit" class="action-btn submit-btn">Add Event</button>
    </form>
</div>

}
else
{
    <div style="text-align:center; margin-top:20px;">
        <p><strong>Only logged-in users can add events or announcements.</strong></p>
       <br/> 
    </div>
}

<!-- Search Events -->
<div class="search-events">
    <h3>Search Events</h3>
    <form asp-action="Search" asp-controller="Events" method="get" class="search-bar-form">
        <input type="text" name="category" placeholder="Search by category..." />
        <input type="date" name="eventDate" />
        <button type="submit" class="action-btn submit-btn">Search</button>
    </form>

    @if (TempData["SearchMessage"] != null)
    {
        <div id="search-tooltip" class="tooltip">@TempData["SearchMessage"]</div>
        <script>
            setTimeout(() => document.getElementById('search-tooltip').style.display = 'none', 3000);
        </script>
    }
</div>

<!-- Display Events -->
<div class="event-list-full">
    <h3>Upcoming Events & Announcements</h3>
    @if (Model.Events != null && Model.Events.Count > 0)
    {
        <div class="events-grid">
            @foreach (var e in Model.Events)
            {
                <div class="event-card">
                    @if (!string.IsNullOrEmpty(e.PhotoPath))
                    {
                        <img src="@e.PhotoPath" alt="Event Photo" class="event-photo" />
                    }
                    <h4>@e.Title (@e.Type)</h4>
                    <p>@e.Description</p>
                    <p><em>Category:</em> @e.Category</p>
                    <p><em>Date:</em> @e.EventDate.ToShortDateString()</p>
                </div>
            }
        </div>
    }
    else
    {
        <p>No events found.</p>
    }
</div>

<!-- Recommended Events Section (Chatgpt) -->
@if (ViewBag.Recommendations != null && ((List<Event>)ViewBag.Recommendations).Any())
{
    <hr />
    <div class="recommended-section">
        <h3 style="color:cadetblue; text-align:center;">Recommended Events</h3>
        <div class="events-grid">
            @foreach (var e in (List<Event>)ViewBag.Recommendations)
            {
                <div class="event-card recommended">
                    <img src="@e.PhotoPath" alt="@e.Title" class="event-photo" />
                    <h4>@e.Title</h4>
                    <p>@e.Description</p>
                    <p><em>Category:</em> @e.Category</p>
                    <p><em>Date:</em> @e.EventDate.ToShortDateString()</p>
                </div>
            }
        </div>
    </div>
}

<!-- Back Button -->
<div class="form-buttons" style="text-align:center;">
    <a asp-controller="Home" asp-action="Index" class="back-btn">Back to Main Menu</a>
</div>

<style>
    /* General Layout */
    body {
        font-family: Arial, sans-serif;
        background-color: #f0f8ff;
    }

    h3 {
        color: cadetblue;
        text-align: center;
    }

    /* Containers */
    .event-form, .search-events {
        margin: 20px auto;
        max-width: 600px;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 12px;
        box-shadow: 0px 4px 8px rgba(0,0,0,0.1);
        background-color: #fff;
    }

    /* Inputs */
    input, textarea, select {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 6px;
        border: 1px solid #ccc;
    }

    .action-btn {
        width: 100%;
        padding: 12px;
        border-radius: 12px;
        background-color: cadetblue;
        color: #fff;
        font-weight: bold;
        border: none;
        cursor: pointer;
        margin-top: 10px;
        transition: background-color 0.2s;
    }

        .action-btn:hover {
            background-color: #3b8b8b;
        }

    /* Search Bar */
    .search-bar-form {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 10px;
    }

        .search-bar-form input[type="text"],
        .search-bar-form input[type="date"] {
            flex: 1 1 200px;
            padding: 10px 15px;
            border-radius: 20px;
            border: 1px solid #ccc;
        }

    /* Tooltip */
    .tooltip {
        background-color: #4BB543;
        color: white;
        padding: 10px 15px;
        border-radius: 8px;
        width: fit-content;
        margin: 10px auto;
        text-align: center;
    }

    /* Events Grid */
    .event-list-full {
        width: 95%;
        max-width: 1400px;
        margin: 20px auto;
        padding: 20px;
        border-radius: 12px;
        background-color: #fff;
    }

    .events-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        margin-top: 20px;
    }

    .event-card {
        border: 1px solid #ccc;
        border-radius: 12px;
        padding: 15px;
        background-color: #f9f9f9;
        text-align: center;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        transition: transform 0.2s, box-shadow 0.2s;
    }

        .event-card:hover {
            transform: scale(1.03);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

    .event-photo {
        width: 100%;
        height: 220px;
        object-fit: cover;
        border-radius: 10px;
        margin-bottom: 10px;
    }

    .event-card h4 {
        color: cadetblue;
        margin-bottom: 8px;
    }

    .event-card p {
        font-size: 0.95rem;
        margin: 5px 0;
    }

    /* Recommended Section */
    .recommended-section {
        margin-top: 40px;
        padding: 20px;
        background-color: #f3fcff;
        border-radius: 12px;
    }

    .event-card.recommended {
        border: 2px solid cadetblue;
        background-color: #e6f7ff;
    }

    /* Back Button */
    .back-btn {
        display: inline-block;
        padding: 12px 30px;
        border-radius: 20px;
        background: cadetblue;
        color: white;
        font-weight: bold;
        text-decoration: none;
        transition: transform 0.2s, background-color 0.2s;
    }

        .back-btn:hover {
            background-color: #3b8b8b;
            transform: scale(1.05);
        }
</style>


